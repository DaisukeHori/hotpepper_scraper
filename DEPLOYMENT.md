# Vercelデプロイガイド

## デプロイ対応状況

- Vercel Hobbyプラン（無料）: 対応済み
- Vercel Proプラン: 対応済み

## Hobbyプラン対応の仕組み

Vercel Hobbyプランには10秒のタイムアウト制限がありますが、以下の実装により対応しています：

### チャンク式リレー処理

```
[クライアント] → POST /api/scrape (phase: collect)
              ← 店舗リスト取得

[クライアント] → POST /api/scrape (phase: process, startIndex: 0)
              ← 15店舗分の結果

[クライアント] → POST /api/scrape (phase: process, startIndex: 15)
              ← 15店舗分の結果

... (繰り返し)

[クライアント] → 全結果をCSV化
```

- 1チャンク = 15店舗（約7秒で処理）
- 各チャンク内で3並列処理
- チャンク間は30ms遅延

## デプロイ手順

### 方法1: GitHub連携（推奨）

1. GitHubにリポジトリをプッシュ
2. [Vercel](https://vercel.com) にログイン
3. 「Import Project」→ GitHubリポジトリを選択
4. デプロイ設定はデフォルトでOK
5. 「Deploy」をクリック

以降、mainブランチへのプッシュで自動デプロイ。

### 方法2: Vercel CLI

```bash
# Vercel CLIをインストール
npm install -g vercel

# ログイン
vercel login

# デプロイ（プレビュー）
vercel

# デプロイ（本番）
vercel --prod
```

## 環境変数

特に必要な環境変数はありません。

## デプロイ後の確認

1. トップページが表示されること
2. キーワード検索が動作すること
3. スクレイピングが完了すること
4. CSVダウンロードが動作すること

## パフォーマンス目安

| 店舗数 | 処理時間 | チャンク数 |
|--------|----------|------------|
| 20店舗 | 約7秒 | 2 |
| 50店舗 | 約25秒 | 4 |
| 100店舗 | 約50秒 | 7 |
| 200店舗 | 約100秒 | 14 |

## トラブルシューティング

### タイムアウトエラーが発生する

通常は発生しませんが、以下を確認：
- ネットワーク遅延が大きい場合
- HotPepper Beautyのサーバーが遅い場合

### CSVが空になる

- HotPepper Beautyの仕様変更の可能性
- セレクタの確認が必要

### レート制限エラー

- 短時間に大量のリクエストを送ると制限される場合あり
- 時間をおいて再試行

## モニタリング

Vercelダッシュボードで確認：
- Functions → 実行時間、エラー率
- Analytics → アクセス状況
- Logs → エラーログ

## Proプランへのアップグレード

大量処理が必要な場合はProプラン（月$20〜）を検討：
- タイムアウト: 60秒（Hobbyは10秒）
- 並列実行数の増加
- 高度な分析機能
